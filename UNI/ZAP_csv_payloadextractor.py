import csv
import re
import sys
import argparse

def extract_strings(search_string, input_csv, output_lst):
    pattern = re.compile(r'\[(.*?)\]')
    with open(input_csv, 'r') as csvfile, open(output_lst, 'w') as lstfile:
        csv_reader = csv.reader(csvfile)
        for row in csv_reader:
            if any(search_string in cell for cell in row):
                for cell in row:
                    matches = pattern.findall(cell)
                    for match in matches:
                        lstfile.write(match + '\n')

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Extract strings between brackets from a CSV file where a specific string is found.')
    parser.add_argument('search_string', help='The string to search for in the CSV file.')
    parser.add_argument('input_file', help='The input CSV file.')
    parser.add_argument('-o', '--output_file', required=True, help='The output .lst file.')

    args = parser.parse_args()

    extract_strings(args.search_string, args.input_file, args.output_file)
